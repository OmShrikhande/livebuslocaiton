<!DOCTYPE html>
<html>
<head>
  <title>Real-Time Bus Tracker</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
      z-index: 0;
    }
    #info-display-container {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 220px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
      padding: 15px;
      color: white;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      text-align: center;
    }
    .info-box {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.2);
    }
    #reset-button {
      background: red;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      border-radius: 5px;
      margin-top: 5px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div id="map"></div>
  <div id="info-display-container">
    <div class="info-box">Speed: <span id="speed-display">--</span> km/h</div>
    <div class="info-box">Daily Distance: <span id="daily-distance">--</span> km</div>
    <div class="info-box">Total Distance: <span id="total-distance">--</span> km</div>
    <button id="reset-button">Reset Total Distance</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAc_3UzizC6Y-hzI_5fDYmXiTSTwR69oac",
      authDomain: "bus-tracker-4e0fc.firebaseapp.com",
      databaseURL: "https://bus-tracker-4e0fc-default-rtdb.firebaseio.com",
      projectId: "bus-tracker-4e0fc",
      storageBucket: "bus-tracker-4e0fc.appspot.com",
      messagingSenderId: "899399291440",
      appId: "1:899399291440:web:1c4535401988d905e293f5"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let map, marker;

    function initMap() {
      map = L.map('map', { zoomControl: false }).setView([21.1496273646212, 79.08079485255764], 18);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      
      const busIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/201/201818.png',
        iconSize: [40, 40],
        iconAnchor: [20, 20]
      });
      
      marker = L.marker([21.1496273646212, 79.08079485255764], { icon: busIcon }).addTo(map);
      trackLiveLocation();
    }

    function trackLiveLocation() {
      database.ref('bus').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data || !data.Location) return;
        
        const { Latitude, Longitude, Speed } = data.Location;
        if (Latitude && Longitude) {
          marker.setLatLng([Latitude, Longitude]);
          map.setView([Latitude, Longitude], 18);
        }
        document.getElementById("speed-display").innerText = Speed ? Speed.toFixed(2) : "--";
        document.getElementById("daily-distance").innerText = data.Distance?.DailyDistance ? data.Distance.DailyDistance.toFixed(2) : "--";
        document.getElementById("total-distance").innerText = data.Distance?.TotalDistance ? data.Distance.TotalDistance.toFixed(2) : "--";
      });
    }

    document.getElementById("reset-button").addEventListener("click", () => {
      database.ref('bus/Distance/TotalDistance').set(0);
      document.getElementById("total-distance").innerText = "0.00";
    });

    window.onload = initMap;
  </script>
</body>
</html>
